"use strict";
var index_1 = require("../b-tree/index");
var b_exp_tree_1 = require('../b-exp-tree');
function shouldWrap(tree, branch) {
    return index_1.isBTree(tree[branch]) && tree[branch].value !== 'NOT' && tree[branch].value !== tree.value;
}
function quotes(text) {
    return /\s+/.test(text) ? "\"" + text + "\"" : text;
}
/**
 * Created by dennis on 29/11/2016.
 */
function toBoolString(tree) {
    return index_1.fold(tree, function (elem, l, r) {
        if (index_1.isBTree(elem)) {
            var nL = shouldWrap(elem, 'left') ? "(" + l + ")" : l;
            var nR = shouldWrap(elem, 'right') ? "(" + r + ")" : r;
            if (elem.value === 'NOT') {
                return elem.value + " " + nR;
            }
            else if (elem.value === 'AND') {
                return nL + " " + nR;
            }
            else {
                return nL + " " + elem.value + " " + nR;
            }
        }
        else if (b_exp_tree_1.isFilter(elem)) {
            return elem.predicate + ":" + quotes(elem.text);
        }
        else if (b_exp_tree_1.isTerm(elem)) {
            return quotes(elem.text);
        }
        else {
            return l + r;
        }
    }, '');
}
exports.toBoolString = toBoolString;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaW5nLXNlcmlhbGl6ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbWFpbi9zZXJpYWxpemVycy9zdHJpbmctc2VyaWFsaXplci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0JBQW1DLGlCQUFpQixDQUFDLENBQUE7QUFDckQsMkJBQThFLGVBQWUsQ0FBQyxDQUFBO0FBRTlGLG9CQUFvQixJQUF1QyxFQUFFLE1BQWM7SUFDekUsTUFBTSxDQUFDLGVBQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxLQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUM7QUFDcEcsQ0FBQztBQUVELGdCQUFnQixJQUFJO0lBQ2xCLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQUksSUFBSSxPQUFHLEdBQUcsSUFBSSxDQUFDO0FBQy9DLENBQUM7QUFFRDs7R0FFRztBQUNILHNCQUE2QixJQUFtRDtJQUM5RSxNQUFNLENBQUMsWUFBSSxDQUFDLElBQUksRUFBRSxVQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUMzQixFQUFFLENBQUMsQ0FBQyxlQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQU0sRUFBRSxHQUFHLFVBQVUsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEdBQUcsTUFBSSxDQUFDLE1BQUcsR0FBRyxDQUFDLENBQUM7WUFDbkQsSUFBTSxFQUFFLEdBQUcsVUFBVSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxNQUFJLENBQUMsTUFBRyxHQUFHLENBQUMsQ0FBQztZQUVwRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3pCLE1BQU0sQ0FBSSxJQUFJLENBQUMsS0FBSyxTQUFJLEVBQUksQ0FBQTtZQUM5QixDQUFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsTUFBTSxDQUFJLEVBQUUsU0FBSSxFQUFJLENBQUM7WUFDdkIsQ0FBQztZQUNELElBQUksQ0FBQyxDQUFDO2dCQUNKLE1BQU0sQ0FBSSxFQUFFLFNBQUksSUFBSSxDQUFDLEtBQUssU0FBSSxFQUFJLENBQUM7WUFDckMsQ0FBQztRQUNILENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMscUJBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEIsTUFBTSxDQUFJLElBQUksQ0FBQyxTQUFTLFNBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUcsQ0FBQztRQUNsRCxDQUFDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLG1CQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNCLENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNKLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2QsQ0FBQztJQUVILENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUNSLENBQUM7QUEzQmUsb0JBQVksZUEyQjNCLENBQUEifQ==